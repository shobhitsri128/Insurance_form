<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <script src="http://code.angularjs.org/1.2.13/angular.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/angular-ui-router/0.4.2/angular-ui-router.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@9"></script>
    <link rel="icon" href="img/mdb-favicon.ico" type="image/x-icon">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.11.2/css/all.css">
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <link rel="stylesheet" href="css/mdb.min.css">
    <link rel="stylesheet" href="css/style.css">
    </script>
    <title>Insurance</title>
    <link rel="stylesheet" href="css/main.css">
</head>

<body ng-app="Insurance" ng-controller="mainController">
    <nav class="navbar navbar-expand-md navbar-dark mdb-color mb-5">
        <div class="mr-auto">

            <nav aria-label="breadcrumb">
                <ol class="breadcrumb d-inline-flex pl-0 pt-0">
                    <li class="breadcrumb-item"><a class="white-text" href="#!">Home</a></li>
                    <li class="breadcrumb-item active">{{heading}}</li>
                </ol>
            </nav>

        </div>
    </nav>
    <div>
        <div class="container-fluid">
            <div ui-view>
                <!-- // pages comes here -->
            </div>
        </div>
    </div>
    <br>
    <br>
    <div class="footer">
      <center><span>Deisgned By <b>Shobhit Srivastava</b><i class="fa fa-copyright"></i></span></center>
    </div>
    <script type="text/javascript">
        var app = angular.module('Insurance', ['ui.router']);
        app.controller('mainController', function($scope, $state, $timeout, $rootScope) {
            $rootScope.$on('$stateChangeStart',
                function(event, toState, toParams, fromState, fromParams) {
                    $timeout(function() {
                        if ($state.current.name == "Payment")
                            $scope.heading = "Payment";
                        else if ($state.current.name == "Personal")
                            $scope.heading = "Personal";
                        else if ($state.current.name == "BuyInsurance")
                            $scope.heading = "Buy Insurance";
                        else {
                            $scope.heading = "";
                        }
                    }, 500)
                })
        })
        app.controller('PersonalController', function($scope, $state, $stateParams) {
            $scope.premium = $stateParams.premium;
            $scope.pay = function() {
                Swal.fire({
                    title: 'Do you want to proceed to pay?',
                    text: "Your Insurance premium per month is ₹" + $scope.premium,
                    icon: 'success',
                    showCancelButton: true,
                    confirmButtonColor: '#3085d6',
                    cancelButtonColor: '#d33',
                    confirmButtonText: 'Yes, Proceed'
                }).then((result) => {
                    if (result.value) {
                        Swal.fire('Success', 'Payment Successfull', 'success');
                        $state.go("Payment", {
                            premium: $scope.premium
                        });
                    }
                })
            }
        });
        app.controller('BuyInsuranceController', function($scope, $state, COUNTRY_CODE) {
            $scope.country_code_dropdown = COUNTRY_CODE;
            $scope.insurance_for_dropdown = [{
                    'key': '1',
                    'value': 'Self'
                },
                {
                    'key': '2',
                    'value': 'Spouse'
                },
                {
                    'key': '3',
                    'value': 'Son'
                },
                {
                    'key': '4',
                    'value': 'Daughter'
                }
            ];
            $scope.clear = function() {
                $scope.insurance_for = null;
                $scope.fname = null;
                $scope.lname = null;
                $scope.gender = null;
                $scope.age = null;
                $scope.country_code = null;
                $scope.phno = null;
                $scope.city = null;
                $scope.email = null;
                $scope.smoking = null;

            }
            $scope.get_quote = function() {
                if ($scope.age < 20) {
                    Swal.fire('Warning', 'No insurance premium available at this age', 'warning');
                } else {
                    var premium_pre = ($scope.age - 20) * 2;
                    $scope.premium = 2000 + 2000 * premium_pre / 100;
                    Swal.fire({
                        title: 'Do you want to proceed?',
                        text: "Your Insurance premium per month is ₹" + $scope.premium,
                        icon: 'success',
                        showCancelButton: true,
                        confirmButtonColor: '#3085d6',
                        cancelButtonColor: '#d33',
                        confirmButtonText: 'Yes, Proceed'
                    }).then((result) => {
                        if (result.value) {
                            $state.go("Personal", {
                                premium: $scope.premium
                            });
                        }
                    })
                }
            }
        });
        app.controller('PaymentController', function($scope, $http, $stateParams) {
            $scope.rupee_range = 50;
            $scope.gbp_range = 50;
            $stateParams.premium = 2200;
            $scope.premium = $stateParams.premium;

            $http.get("https://api.exchangeratesapi.io/latest?symbols=INR")
                .then(function(response) {
                    $scope.rate = response.data.rates.INR;
                    $scope.premium_rupees = $stateParams.premium / 2.0;
                    $scope.premium_gbp = (($stateParams.premium / 2.0) / $scope.rate).toFixed(2);
                    $scope.discount = 10;
                    $scope.payable_rupees = ($scope.premium_rupees - $scope.premium_rupees * 0.1).toFixed(2);
                    $scope.payable_gbp = ($scope.premium_gbp - $scope.premium_gbp * 0.1).toFixed(2);
                    $scope.payable_premium = ($scope.premium - $scope.premium * 0.1).toFixed(2);

                });
            $scope.calculateDiscount = function() {
                $scope.rupee_range = $scope.slider_range;
                $scope.gbp_range = 100 - $scope.slider_range;
                $scope.premium_rupees = $stateParams.premium * $scope.rupee_range / 100;
                $scope.premium_gbp = (($stateParams.premium * $scope.gbp_range / 100) / $scope.rate).toFixed(2);
                $scope.discount = (10 - Math.abs($scope.rupee_range - $scope.gbp_range) / 10).toFixed(2);
                $scope.payable_rupees = ($scope.premium_rupees - $scope.premium_rupees * $scope.discount / 100).toFixed(2);
                $scope.payable_gbp = ($scope.premium_gbp - $scope.premium_gbp * $scope.discount / 100).toFixed(2);
                $scope.payable_premium = ($scope.premium - $scope.premium * $scope.discount / 100).toFixed(2);
            }
            $scope.finalPay = function() {
                Swal.fire('Success', 'Payment Successfull', 'success')
            }
        });
        app.config(function($stateProvider, $urlRouterProvider) {
            $urlRouterProvider.otherwise('/home');
            $stateProvider
                .state('home', {
                    url: '/home',
                    templateUrl: 'home.html',
                })
                .state('BuyInsurance', {
                    url: '/BuyInsurance',
                    templateUrl: 'BuyInsurance.html',
                    controller: 'BuyInsuranceController',
                })
                .state('Personal', {
                    url: '/Personal',
                    templateUrl: 'Personal.html',
                    controller: 'PersonalController',
                    params: {
                        premium: null
                    }
                })
                .state('Payment', {
                    url: '/Payment',
                    templateUrl: 'Payment.html',
                    controller: 'PaymentController',
                    params: {
                        premium: null
                    }
                })

        });
        app.constant('COUNTRY_CODE', [93, 355, 213, 1 - 684, 376, 244, 1 - 264, 672, 1 - 268, 54, 374, 297, 61, 43, 994, 1 - 242, 973, 880, 1 - 246, 375, 32, 501, 229, 1 - 441, 975, 591, 387, 267, 55, 246, 1 - 284, 673, 359, 226, 257, 855, 237, 1,
            238, 1 - 345, 236, 235, 56, 86, 61, 61, 57, 269, 682, 506, 385, 53, 599, 357, 420, 243, 45, 253, 1 - 767, 1 - 809, 1 - 829, 1 - 849, 670, 593, 20, 503, 240, 291, 372, 251, 500, 298, 679, 358, 33, 689, 241, 220, 995, 49, 233, 350,
            30, 299, 1 - 473, 1 - 671, 502, 44 - 1481, 224, 245, 592, 509, 504, 852, 36, 354, 91, 62, 98, 964, 353, 44 - 1624, 972, 39, 225, 1 - 876, 81, 44 - 1534, 962, 7, 254, 686, 383, 965, 996, 856, 371, 961, 266, 231, 218, 423, 370, 352,
            853, 389, 261, 265, 60, 960, 223, 356, 692, 222, 230, 262, 52, 691, 373, 377, 976, 382, 1 - 664, 212, 258, 95, 264, 674, 977, 31, 599, 687, 64, 505, 227, 234, 683, 850, 1 - 670, 47, 968, 92, 680, 970, 507, 675, 595, 51, 63, 64,
            48, 351, 1 - 787, 1 - 939, 974, 242, 262, 40, 7, 250, 590, 290, 1 - 869, 1 - 758, 590, 508, 1 - 784, 685, 378, 239, 966, 221, 381, 248, 232, 65, 1 - 721, 421, 386, 677, 252, 27, 82, 211, 34, 94, 249, 597, 47, 268, 46, 41, 963,
            886, 992, 255, 66, 228, 690, 676, 1 - 868, 216, 90, 993, 1 - 649, 688, 1 - 340, 256, 380, 971, 44, 1, 598, 998, 678, 379, 58, 84, 681, 212, 967, 260, 263
        ]);
    </script>
    <script type="text/javascript" src="js/jquery.min.js"></script>
    <script type="text/javascript" src="js/popper.min.js"></script>
    <script type="text/javascript" src="js/bootstrap.min.js"></script>
    <script type="text/javascript" src="js/mdb.min.js"></script>
</body>

</html>
